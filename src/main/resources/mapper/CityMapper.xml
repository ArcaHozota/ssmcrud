<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jp.co.toshiba.ppok.mapper.CityMapper">
	<resultMap id="BasicResultMap"
		type="jp.co.toshiba.ppok.entity.City">
		<id column="ID" jdbcType="NUMERIC" property="id" />
		<result column="NAME" jdbcType="NVARCHAR" property="name" />
		<result column="COUNTRY_CODE" jdbcType="NCHAR"
			property="countryCode" />
		<result column="DISTRICT" jdbcType="NVARCHAR"
			property="district" />
		<result column="POPULATION" jdbcType="NUMERIC"
			property="population" />
		<result column="LOGIC_DELETE_FLG" jdbcType="NVARCHAR"
			property="logicDeleteFlg" />
	</resultMap>
	<insert id="saveById"
		parameterType="jp.co.toshiba.ppok.entity.City">
		INSERT INTO WORLD_CITY(NAME, COUNTRY_CODE,
		DISTRICT,
		POPULATION, LOGIC_DELETE_FLG)
		VALUES (#{name,jdbcType=NVARCHAR},
		#{countryCode,jdbcType=NCHAR},
		#{district,jdbcType=NVARCHAR},
		#{population,jdbcType=NUMERIC},
		#{logicDeleteFlg,jdbcType=NVARCHAR})
	</insert>
	<update id="removeById" parameterType="java.lang.Integer">
		UPDATE WORLD_CITY CN
		SET
		CN.LOGIC_DELETE_FLG = 'removed'
		WHERE CN.ID = #{id,jdbcType=NUMERIC}
	</update>
	<update id="updateById"
		parameterType="jp.co.toshiba.ppok.entity.City">
		UPDATE WORLD_CITY CN
		<set>
			<if test="name != null">
				CN.NAME = #{name,jdbcType=NVARCHAR},
			</if>
			<if test="countryCode != null">
				CN.COUNTRY_CODE = #{countryCode,jdbcType=NCHAR},
			</if>
			<if test="district != null">
				CN.DISTRICT = #{district,jdbcType=NVARCHAR},
			</if>
			<if test="population != null">
				CN.POPULATION = #{population,jdbcType=NUMERIC},
			</if>
		</set>
		WHERE CN.LOGIC_DELETE_FLG = 'visible'
		AND CN.ID =
		#{id,jdbcType=NUMERIC}
	</update>
	<select id="getCityInfos"
		resultType="jp.co.toshiba.ppok.dto.CityDto">
		SELECT SUB.ID, SUB.NAME, SUB.CONTINENT,
		SUB.NATION,
		SUB.DISTRICT, SUB.POPULATION
		FROM (SELECT ROWNUM AS ROWNO, CWV.ID,
		CWV.NAME,
		CWV.CONTINENT, CWV.NATION, CWV.DISTRICT, CWV.POPULATION
		FROM
		WORLD_CITY_VIEW CWV
		WHERE ROWNUM &lt;= #{pageMax,jdbcType=NUMERIC}) SUB
		WHERE SUB.ROWNO &gt; #{pageMin,jdbcType=NUMERIC}
	</select>
	<select id="getCityInfosCnt" resultType="java.lang.Integer">
		SELECT COUNT(1)
		FROM
		WORLD_CITY_VIEW CWV
	</select>
	<select id="getByNations"
		resultType="jp.co.toshiba.ppok.dto.CityDto">
		SELECT SUB.ID, SUB.NAME, SUB.CONTINENT,
		SUB.NATION,
		SUB.DISTRICT, SUB.POPULATION
		FROM (SELECT ROWNUM AS ROWNO, CWV.ID,
		CWV.NAME,
		CWV.CONTINENT, CWV.NATION, CWV.DISTRICT, CWV.POPULATION
		FROM
		WORLD_CITY_VIEW CWV
		WHERE CWV.NATION = #{nation,jdbcType=NVARCHAR}
		AND
		ROWNUM &lt;= #{pageMax,jdbcType=NUMERIC}) SUB
		WHERE SUB.ROWNO &gt;
		#{pageMin,jdbcType=NUMERIC}
	</select>
	<select id="getByNationsCnt" parameterType="java.lang.String"
		resultType="java.lang.Integer">
		SELECT COUNT(1)
		FROM WORLD_CITY_VIEW CWV
		WHERE CWV.NATION =
		#{nation,jdbcType=NVARCHAR}
	</select>
	<select id="getByNames"
		resultType="jp.co.toshiba.ppok.dto.CityDto">
		SELECT SUB.ID, SUB.NAME, SUB.CONTINENT,
		SUB.NATION,
		SUB.DISTRICT, SUB.POPULATION
		FROM (SELECT ROWNUM AS ROWNO, CWV.ID,
		CWV.NAME, CWV.CONTINENT,
		CWV.NATION, CWV.DISTRICT, CWV.POPULATION
		FROM
		WORLD_CITY_VIEW CWV
		WHERE CWV.NAME LIKE CONCAT('%',
		#{name,jdbcType=NVARCHAR}, '%')
		AND ROWNUM &lt;=
		#{pageMax,jdbcType=NUMERIC}) SUB
		WHERE SUB.ROWNO &gt;
		#{pageMin,jdbcType=NUMERIC}
	</select>
	<select id="getByNamesCnt" parameterType="java.lang.String"
		resultType="java.lang.Integer">
		SELECT COUNT(1)
		FROM WORLD_CITY_VIEW CWV
		WHERE CWV.NAME LIKE
		CONCAT('%', #{name,jdbcType=NVARCHAR}, '%')
	</select>
	<select id="getMinimumRanks"
		resultType="jp.co.toshiba.ppok.dto.CityDto">
		SELECT SUB.ID, SUB.NAME, SUB.CONTINENT,
		SUB.NATION,
		SUB.DISTRICT, SUB.POPULATION
		FROM (SELECT CWV.ID, CWV.NAME,
		CWV.CONTINENT,
		CWV.NATION,
		CWV.DISTRICT, CWV.POPULATION
		FROM WORLD_CITY_VIEW CWV
		ORDER BY CWV.POPULATION ASC) SUB
		WHERE ROWNUM &lt;= 15
	</select>
	<select id="getMaximumRanks"
		resultType="jp.co.toshiba.ppok.dto.CityDto">
		SELECT SUB.ID, SUB.NAME, SUB.CONTINENT,
		SUB.NATION,
		SUB.DISTRICT, SUB.POPULATION
		FROM (SELECT CWV.ID, CWV.NAME,
		CWV.CONTINENT,
		CWV.NATION,
		CWV.DISTRICT, CWV.POPULATION
		FROM WORLD_CITY_VIEW CWV
		ORDER BY CWV.POPULATION DESC) SUB
		WHERE ROWNUM &lt;= 15
	</select>
	<select id="getCityInfoById" parameterType="java.lang.Integer"
		resultType="jp.co.toshiba.ppok.dto.CityDto">
		SELECT CWV.ID, CWV.NAME,
		CWV.CONTINENT,
		CWV.NATION,
		CWV.DISTRICT, CWV.POPULATION
		FROM WORLD_CITY_VIEW CWV
		WHERE CWV.ID =
		#{id,jdbcType=NUMERIC}
	</select>
	<select id="checkName" parameterType="java.lang.String"
		resultType="java.lang.Integer">
		SELECT COUNT(1)
		FROM WORLD_CITY CN
		WHERE CN.NAME =
		#{cityName,jdbcType=NVARCHAR}
	</select>
</mapper>